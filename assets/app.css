document.addEventListener('DOMContentLoaded', ()=> {
    // åˆå§‹åŒ–ï¼šé è¨­è¼‰å…¥ A å–®ä½
    loadAUnitData();
    initNavigation();
    initFilters();
  });

// å…¨åŸŸè®Šæ•¸ï¼šç›®å‰é¡¯ç¤ºçš„è³‡æ–™é¡å‹
let currentRoute='aunit';

// 1. è™•ç†å°è¦½åˆ—é»æ“Š
function initNavigation() {
  const navItems=document.querySelectorAll('.nav-item');

  navItems.forEach(btn=> {
      btn.addEventListener('click', (e)=> {
          // ç§»é™¤æ‰€æœ‰ active class
          navItems.forEach(i=> i.classList.remove('active'));
          // åŠ ä¸Šç•¶å‰ active
          const target=e.currentTarget;
          target.classList.add('active');

          // è®€å–è·¯ç”±
          const route=target.dataset.route;
          currentRoute=route;

          // æ ¹æ“šè·¯ç”±æ±ºå®šåšä»€éº¼
          if (route==='aunit') {
            loadAUnitData();
            document.querySelector('.filter-panel').style.display='block'; // é¡¯ç¤ºç¯©é¸å™¨
          }

          else {
            // å…¶ä»–é é¢æš«æ™‚é¡¯ç¤ºæ–½å·¥ä¸­æˆ–ç©ºè³‡æ–™
            loadPlaceholder(route);
            // å¦‚æœæ˜¯è¼ªæ¤…ç”¢ç”Ÿå™¨ï¼Œå¯èƒ½ä¸éœ€è¦ç¯©é¸å™¨ï¼Œé€™è£¡å…ˆä¿ç•™
          }
        });
    });
}

// 2. è¼‰å…¥ A å–®ä½è³‡æ–™ (æ ¸å¿ƒåŠŸèƒ½)
function loadAUnitData() {
  // è¨­å®šæ¨™é¡Œ
  document.getElementById('panelTitle').textContent='A å–®ä½ (ç¤¾å€æ•´åˆå‹æœå‹™ä¸­å¿ƒ) åˆ—è¡¨';

  // é è¨­é¡¯ç¤ºå…¨éƒ¨
  renderGrid(aUnitData);
}

// 3. æ¸²æŸ“ç¶²æ ¼ (ç”¢ç”Ÿå¡ç‰‡)
function renderGrid(data) {
  const gridEl=document.getElementById('grid');
  gridEl.innerHTML=''; // æ¸…ç©º

  if (data.length===0) {
    gridEl.innerHTML='<div style="grid-column: 1/-1; text-align:center; color:#888; padding: 20px;">æŸ¥ç„¡è³‡æ–™</div>';
    return;
  }

  data.forEach(item=> {
      const card=document.createElement('div');
      card.className='card';

      // åˆ¤æ–·è¡Œæ”¿å€é¡è‰² (å¯é¸) - é€™è£¡çµ±ä¸€ä½¿ç”¨
      const badgeColor='#FFF3E0';

      card.innerHTML=` <div class="card-badges" > <span class="badge" style="background:${badgeColor}" >$ {
        item.district
      }

      </span> </div> <h3 class="card-title" >$ {
        item.title
      }

      </h3> <div class="card-info" >ğŸ“ $ {
        item.address
      }

      </div> <div class="card-info" >ğŸ“ $ {
        item.tel
      }

      </div> <div class="card-subtitle" style="margin-top:10px; font-size:0.85rem;" > <span style="font-weight:bold;" >æœå‹™æ¬¡åˆ†å€ï¼š</span>$ {
        item.area || 'å…¨å€'
      }

      </div> `;
      gridEl.appendChild(card);
    });
}

// 4. åˆå§‹åŒ–ç¯©é¸å™¨ (æœå°‹æ¡† + è¡Œæ”¿å€æŒ‰éˆ•)
function initFilters() {
  // è¡Œæ”¿å€æŒ‰éˆ•
  const chips=document.querySelectorAll('.chip');

  chips.forEach(chip=> {
      chip.addEventListener('click', ()=> {
          // æ¨£å¼åˆ‡æ›
          chips.forEach(c=> c.classList.remove('active'));
          chip.classList.add('active');

          // åŸ·è¡Œç¯©é¸
          const district=chip.textContent;
          filterData(district, document.querySelector('.input-search').value);
        });
    });

  // é—œéµå­—æœå°‹
  const searchInput=document.querySelector('.input-search');

  searchInput.addEventListener('input', (e)=> {
      // å–å¾—ç›®å‰é¸ä¸­çš„è¡Œæ”¿å€
      const activeChip=document.querySelector('.chip.active').textContent;
      filterData(activeChip, e.target.value);
    });
}

// 5. åŸ·è¡Œç¯©é¸é‚è¼¯
function filterData(district, keyword) {
  // å¦‚æœä¸åœ¨ A å–®ä½é é¢ï¼Œå…ˆä¸è™•ç† (æˆ–æ˜¯æ“´å……åˆ°å…¶ä»–è³‡æ–™)
  if (currentRoute !=='aunit') return;

  let filtered=aUnitData;

  // 1. ç¯©é¸è¡Œæ”¿å€
  if (district !=='å…¨éƒ¨') {
    filtered=filtered.filter(item=> item.district===district);
  }

  // 2. ç¯©é¸é—œéµå­— (åç¨± æˆ– åœ°å€)
  if (keyword) {
    const key=keyword.toLowerCase();
    filtered=filtered.filter(item=> item.title.toLowerCase().includes(key) || item.address.includes(key));
  }

  // é‡æ–°æ¸²æŸ“
  renderGrid(filtered);
}

// è¼”åŠ©ï¼šè¼‰å…¥æš«ä½ç•«é¢
function loadPlaceholder(route) {
  const titles= {
    'wheelchair': 'ç°¡æ˜“è¼ªæ¤…å°ºå¯¸ç”¢ç”Ÿå™¨',
      'subsidy': 'è¼”å…·ç„¡éšœç¤™è£œåŠ©',
      'vendors': 'è‡ºåŒ—å¸‚è¼”å…·ç„¡éšœç¤™ç‰¹ç´„å» å•†',
      'resources': 'ç¤¾å€æ©Ÿæ§‹è³‡æºç¸½è¦½'
  }

  ;
  document.getElementById('panelTitle').textContent=titles[route];
  document.getElementById('grid').innerHTML='<div style="padding:20px; color:#666;">åŠŸèƒ½å»ºç½®ä¸­...</div>';
}